openapi: 3.0.3
info:
  title: KineticOps API
  description: |-
    Comprehensive infrastructure monitoring and observability platform.
    
    Features:
    - Real-time metrics collection and aggregation
    - Distributed log management
    - Application Performance Monitoring (APM)
    - Synthetic monitoring and uptime checks
    - Advanced alerting and notifications
    - Multi-tenancy support
    - Circuit breakers and rate limiting
    - Session management
    - Comprehensive security (XSS, SQL injection prevention)
  version: 1.0.0
  contact:
    email: support@kineticops.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.kineticops.com/api/v1
    description: Production server

tags:
  - name: Health
    description: Health check and system status
  - name: Authentication
    description: User authentication and authorization
  - name: Hosts
    description: Host management and monitoring
  - name: Metrics
    description: Metrics collection and aggregation
  - name: Logs
    description: Log management and search
  - name: Agents
    description: Agent deployment and management
  - name: Alerts
    description: Alert rules and notifications
  - name: APM
    description: Application Performance Monitoring
  - name: Synthetic
    description: Synthetic monitoring
  - name: Users
    description: User management
  - name: Tenants
    description: Multi-tenancy management

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          example: "Invalid credentials"
        message:
          type: string
          example: "The provided credentials are incorrect"
        status:
          type: integer
          example: 401

    Health:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        timestamp:
          type: integer
          example: 1700000000

    DetailedHealth:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        timestamp:
          type: integer
        services:
          type: object
          properties:
            postgresql:
              $ref: '#/components/schemas/ServiceHealth'
            mongodb:
              $ref: '#/components/schemas/ServiceHealth'
            redis:
              $ref: '#/components/schemas/ServiceHealth'
            circuit_breakers:
              type: object

    ServiceHealth:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        latency:
          type: integer
          example: 5
        connections:
          type: object

    Host:
      type: object
      properties:
        id:
          type: integer
          example: 1
        hostname:
          type: string
          example: "web-server-01"
        ip_address:
          type: string
          example: "192.168.1.100"
        status:
          type: string
          enum: [active, inactive, maintenance]
        tenant_id:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Metric:
      type: object
      properties:
        id:
          type: integer
        host_id:
          type: integer
        name:
          type: string
          example: "cpu_usage"
        value:
          type: number
          format: double
          example: 45.2
        timestamp:
          type: string
          format: date-time
        tags:
          type: object
          additionalProperties:
            type: string

    Log:
      type: object
      properties:
        id:
          type: string
        host_id:
          type: integer
        level:
          type: string
          enum: [debug, info, warn, error, fatal]
        message:
          type: string
        timestamp:
          type: string
          format: date-time
        service:
          type: string
        source:
          type: string

    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        name:
          type: string
        tenant_id:
          type: integer
        role:
          type: string
          enum: [admin, user, viewer]
        created_at:
          type: string
          format: date-time

paths:
  /health:
    get:
      tags:
        - Health
      summary: Basic health check
      description: Returns basic health status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Health'

  /health/detailed:
    get:
      tags:
        - Health
      summary: Detailed health check
      description: Returns detailed health status of all services
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedHealth'

  /health/ready:
    get:
      tags:
        - Health
      summary: Readiness check
      description: Kubernetes readiness probe endpoint
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  ready:
                    type: boolean
        '503':
          description: Service not ready

  /health/live:
    get:
      tags:
        - Health
      summary: Liveness check
      description: Kubernetes liveness probe endpoint
      responses:
        '200':
          description: Service is alive

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and return JWT token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /hosts:
    get:
      tags:
        - Hosts
      summary: List all hosts
      description: Retrieve a list of all monitored hosts
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  hosts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Host'
                  total:
                    type: integer

  /metrics/collect:
    post:
      tags:
        - Metrics
      summary: Collect metrics
      description: Submit metrics from agents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                host_id:
                  type: integer
                metrics:
                  type: array
                  items:
                    $ref: '#/components/schemas/Metric'
      responses:
        '200':
          description: Metrics accepted
        '400':
          description: Invalid request
        '429':
          description: Rate limit exceeded

  /logs/search:
    get:
      tags:
        - Logs
      summary: Search logs
      description: Full-text search across logs
      parameters:
        - name: search
          in: query
          required: true
          schema:
            type: string
        - name: level
          in: query
          schema:
            type: string
            enum: [debug, info, warn, error, fatal]
        - name: start
          in: query
          schema:
            type: string
            format: date-time
        - name: end
          in: query
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      $ref: '#/components/schemas/Log'
                  total:
                    type: integer
